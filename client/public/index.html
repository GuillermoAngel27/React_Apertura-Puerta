<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="theme-color" content="#e0a3ff" />
    <meta name="description" content="Sistema de control de apertura remota de puerta con autenticación segura" />
    <meta name="keywords" content="puerta, control, acceso, seguridad, autenticación" />
    <meta name="author" content="G-Angel" />
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Control Puerta" />
    <meta name="application-name" content="Control Puerta" />
    <meta name="msapplication-TileColor" content="#e0a3ff" />
    <meta name="msapplication-tap-highlight" content="no" />
    
    <!-- Icons -->
    <!-- Favicon estándar -->
    <link rel="icon" type="image/x-icon" href="%PUBLIC_URL%/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="%PUBLIC_URL%/favicon.ico" />
    <link rel="icon" type="image/png" sizes="16x16" href="%PUBLIC_URL%/favicon.ico" />
    
    <!-- Apple Touch Icons (PNG) -->
    <link rel="apple-touch-icon" sizes="192x192" href="%PUBLIC_URL%/logo192.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="%PUBLIC_URL%/logo512.png" />
    
    <!-- Android Chrome Icons (PNG) -->
    <link rel="icon" type="image/png" sizes="192x192" href="%PUBLIC_URL%/logo192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="%PUBLIC_URL%/logo512.png" />
    
    <!-- Manifest -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="http://localhost:5000" />
    
    <title>Control de Puerta - Sistema de Apertura Remota</title>
  </head>
  <body>
    <noscript>Necesitas habilitar JavaScript para ejecutar esta aplicación.</noscript>
    <div id="root"></div>
    
    <!-- PWA Installation Script -->
    <script>
      // Manejar instalación de PWA
      let deferredPrompt;
      let installButton = null;
      
      // Verificar si ya está instalada
      function isAppInstalled() {
        return window.matchMedia('(display-mode: standalone)').matches || 
               window.navigator.standalone === true;
      }
      
      // Verificar si es compatible con PWA
      function isPWACompatible() {
        return 'serviceWorker' in navigator && 'PushManager' in window;
      }
      
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        
        // Solo mostrar si no está instalada y es compatible
        if (!isAppInstalled() && isPWACompatible()) {
          // Mostrar botón de instalación después de 2 segundos
          setTimeout(() => {
            showInstallButton();
          }, 2000);
        }
      });
      
      function showInstallButton() {
        // No mostrar si ya existe o si no hay prompt
        if (installButton || !deferredPrompt) return;
        
        // Crear botón de instalación
        installButton = document.createElement('button');
        installButton.innerHTML = '📱 Instalar App';
        installButton.id = 'pwa-install-button';
        installButton.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 1000;
          background: linear-gradient(135deg, #e0a3ff, #ff69b4);
          color: #000;
          border: none;
          padding: 12px 20px;
          border-radius: 25px;
          font-weight: 600;
          cursor: pointer;
          box-shadow: 0 4px 15px rgba(224, 163, 255, 0.3);
          animation: slideIn 0.3s ease-out;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          font-size: 14px;
          transition: all 0.3s ease;
        `;
        
        // Efecto hover
        installButton.addEventListener('mouseenter', () => {
          installButton.style.transform = 'scale(1.05)';
          installButton.style.boxShadow = '0 6px 20px rgba(224, 163, 255, 0.4)';
        });
        
        installButton.addEventListener('mouseleave', () => {
          installButton.style.transform = 'scale(1)';
          installButton.style.boxShadow = '0 4px 15px rgba(224, 163, 255, 0.3)';
        });
        
        installButton.addEventListener('click', async () => {
          if (deferredPrompt) {
            try {
              deferredPrompt.prompt();
              const { outcome } = await deferredPrompt.userChoice;
              
              if (outcome === 'accepted') {
                console.log('PWA instalada exitosamente');
                hideInstallButton();
              } else {
                console.log('Instalación de PWA cancelada');
              }
              
              deferredPrompt = null;
            } catch (error) {
              console.error('Error durante la instalación:', error);
            }
          }
        });
        
        document.body.appendChild(installButton);
        
        // Remover botón después de 30 segundos
        setTimeout(() => {
          hideInstallButton();
        }, 30000);
      }
      
      function hideInstallButton() {
        if (installButton && installButton.parentNode) {
          installButton.style.animation = 'slideOut 0.3s ease-out';
          setTimeout(() => {
            if (installButton && installButton.parentNode) {
              installButton.remove();
              installButton = null;
            }
          }, 300);
        }
      }
      
      // Detectar si la app está instalada
      window.addEventListener('appinstalled', () => {
        console.log('PWA instalada exitosamente');
        deferredPrompt = null;
        hideInstallButton();
      });
      
      // Detectar cambios en el modo de visualización
      window.addEventListener('resize', () => {
        if (isAppInstalled() && installButton) {
          hideInstallButton();
        }
      });
    </script>
    
    <!-- CSS para animación del botón de instalación -->
    <style>
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      
      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
      
      /* Responsive para móviles */
      @media (max-width: 768px) {
        #pwa-install-button {
          top: 10px !important;
          right: 10px !important;
          padding: 10px 16px !important;
          font-size: 12px !important;
        }
      }
    </style>
  </body>
</html>
